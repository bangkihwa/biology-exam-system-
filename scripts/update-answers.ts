import pg from 'pg';
const { Pool } = pg;

const pool = new Pool({
  connectionString: "postgresql://postgres.bczhuyuundalqqzwyqmt:o8JVCUpWUkbKupVa@aws-1-ap-northeast-2.pooler.supabase.com:6543/postgres",
  ssl: { rejectUnauthorized: false }
});

// 새로운 정답 데이터 (문제번호: 정답)
const answers: Record<number, string> = {
  // [생물의 특성과 물질대사] 1-60
  1: '5', 2: '1', 3: '2', 4: '5', 5: '3', 6: '2', 7: '5', 8: '2', 9: '2', 10: '5',
  11: '2', 12: '5', 13: '4', 14: '5', 15: '1', 16: '4', 17: '5', 18: '4', 19: '2', 20: '3',
  21: '3', 22: '4', 23: '2', 24: '4', 25: '5', 26: '3', 27: '1', 28: '4', 29: '2', 30: '2',
  31: '3', 32: '3', 33: '4', 34: '3', 35: '3', 36: '4', 37: '5', 38: '3', 39: '5', 40: '4',
  41: '2', 42: '4', 43: '1', 44: '3', 45: '5', 46: '1', 47: '5', 48: '2', 49: '3', 50: '3',
  51: '3', 52: '4', 53: '1', 54: '1', 55: '1', 56: '1', 57: '4', 58: '2', 59: '1', 60: '4',

  // [기관계 통합적 작용] 61-118
  61: '5', 62: '4', 63: '5', 64: '1', 65: '2', 66: '2', 67: '4', 68: '3', 69: '4', 70: '4',
  71: '1', 72: '3', 73: '2', 74: '4', 75: '3', 76: '4', 77: '4', 78: '2', 79: '1', 80: '4',
  81: '2', 82: '2', 83: '4', 84: '4', 85: '2', 86: '4', 87: '2', 88: '1', 89: '2', 90: '2',
  91: '5', 92: '5', 93: '2', 94: '5', 95: '5', 96: '3', 97: '5', 98: '5', 99: '2', 100: '5',
  101: '3', 102: '1', 103: '5', 104: '2', 105: '4', 106: '1', 107: '5', 108: '5', 109: '4', 110: '2',
  111: '4', 112: '4', 113: '3', 114: '3', 115: '1', 116: '4', 117: '3', 118: '2',

  // [자극의 전달] 119-180
  119: '1', 120: '2', 121: '3', 122: '3', 123: '5', 124: '2', 125: '3', 126: '2', 127: '5', 128: '3',
  129: '2', 130: '1', 131: '5', 132: '2', 133: '1', 134: '2', 135: '3', 136: '3', 137: '1', 138: '2',
  139: '5', 140: '4', 141: '3', 142: '1', 143: '4', 144: '1', 145: '3', 146: '1', 147: '5', 148: '4',
  149: '2', 150: '1', 151: '1', 152: '1', 153: '5', 154: '5', 155: '4', 156: '1', 157: '5', 158: '5',
  159: '3', 160: '2', 161: '2', 162: '1', 163: '3', 164: '1', 165: '5', 166: '4', 167: '1', 168: '5',
  169: '3', 170: '3', 171: '1', 172: '2', 173: '3', 174: '3', 175: '5', 176: '4', 177: '1', 178: '2',
  179: '1', 180: '2',

  // [신경계] 181-240
  181: '5', 182: '4', 183: '5', 184: '3', 185: '5', 186: '4', 187: '3', 188: '3', 189: '1', 190: '4',
  191: '1', 192: '4', 193: '1', 194: '5', 195: '1', 196: '5', 197: '3', 198: '5', 199: '5', 200: '2',
  201: '3', 202: '4', 203: '4', 204: '3', 205: '5', 206: '5', 207: '3', 208: '3', 209: '4', 210: '5',
  211: '2', 212: '2', 213: '5', 214: '3', 215: '3', 216: '4', 217: '5', 218: '3', 219: '1', 220: '2',
  221: '5', 222: '1', 223: '5', 224: '5', 225: '3', 226: '2', 227: '5', 228: '4', 229: '1', 230: '4',
  231: '4', 232: '3', 233: '5', 234: '4', 235: '3', 236: '5', 237: '4', 238: '2', 239: '1', 240: '5',

  // [항상성 조절] 241-300
  241: '2', 242: '4', 243: '2', 244: '3', 245: '5', 246: '5', 247: '1', 248: '5', 249: '1', 250: '4',
  251: '4', 252: '3', 253: '1', 254: '4', 255: '2', 256: '2', 257: '5', 258: '4', 259: '5', 260: '4',
  261: '4', 262: '3', 263: '2', 264: '5', 265: '5', 266: '2', 267: '5', 268: '5', 269: '5', 270: '2',
  271: '4', 272: '5', 273: '4', 274: '5', 275: '3', 276: '3', 277: '1', 278: '2', 279: '4', 280: '2',
  281: '3', 282: '2', 283: '5', 284: '4', 285: '5', 286: '2', 287: '5', 288: '2', 289: '4', 290: '3',
  291: '5', 292: '4', 293: '1', 294: '5', 295: '5', 296: '3', 297: '4', 298: '2', 299: '3', 300: '3',

  // [방어 작용] 301-360
  301: '1', 302: '4', 303: '4', 304: '1', 305: '1', 306: '2', 307: '5', 308: '2', 309: '4', 310: '5',
  311: '1', 312: '3', 313: '2', 314: '2', 315: '2', 316: '1', 317: '2', 318: '4', 319: '3', 320: '5',
  321: '4', 322: '3', 323: '3', 324: '3', 325: '2', 326: '4', 327: '1', 328: '5', 329: '3', 330: '2',
  331: '2', 332: '3', 333: '4', 334: '1', 335: '1', 336: '5', 337: '1', 338: '2', 339: '3', 340: '4',
  341: '4', 342: '2', 343: '5', 344: '3', 345: '3', 346: '3', 347: '5', 348: '2', 349: '5', 350: '5',
  351: '4', 352: '5', 353: '2', 354: '2', 355: '2', 356: '3', 357: '5', 358: '5', 359: '2', 360: '2',

  // [염색체와 세포분열] 361-420
  361: '3', 362: '1', 363: '4', 364: '3', 365: '5', 366: '3', 367: '3', 368: '5', 369: '4', 370: '3',
  371: '5', 372: '5', 373: '2', 374: '1', 375: '5', 376: '4', 377: '2', 378: '2', 379: '3', 380: '5',
  381: '2', 382: '2', 383: '1', 384: '3', 385: '1', 386: '5', 387: '5', 388: '5', 389: '1', 390: '2',
  391: '5', 392: '4', 393: '2', 394: '4', 395: '5', 396: '2', 397: '4', 398: '3', 399: '1', 400: '3',
  401: '4', 402: '2', 403: '4', 404: '3', 405: '1', 406: '5', 407: '2', 408: '2', 409: '5', 410: '2',
  411: '5', 412: '5', 413: '3', 414: '1', 415: '4', 416: '5', 417: '3', 418: '2', 419: '2', 420: '5',

  // [생물의 진화] 421-447
  421: '5', 422: '5', 423: '4', 424: '4', 425: '2', 426: '4', 427: '1', 428: '4', 429: '5', 430: '3',
  431: '4', 432: '5', 433: '2', 434: '3', 435: '5', 436: '5', 437: '5', 438: '2', 439: '2', 440: '3',
  441: '4', 442: '1', 443: '5', 444: '5', 445: '3', 446: '3', 447: '1',
};

// 단원 매핑 (문제번호 범위 -> 단원명)
function getUnit(questionNumber: number): string {
  if (questionNumber >= 1 && questionNumber <= 60) return '생물의 특성과 물질대사';
  if (questionNumber >= 61 && questionNumber <= 118) return '기관계 통합적 작용';
  if (questionNumber >= 119 && questionNumber <= 180) return '자극의 전달';
  if (questionNumber >= 181 && questionNumber <= 240) return '신경계';
  if (questionNumber >= 241 && questionNumber <= 300) return '항상성 조절';
  if (questionNumber >= 301 && questionNumber <= 360) return '방어 작용';
  if (questionNumber >= 361 && questionNumber <= 420) return '염색체와 세포분열';
  if (questionNumber >= 421 && questionNumber <= 447) return '생물의 진화';
  return '';
}

async function updateAnswers() {
  const client = await pool.connect();

  try {
    console.log('데이터베이스 연결 성공!');

    // id 312 = 문제 1번
    const baseId = 311;
    let updatedCount = 0;
    let errorCount = 0;

    for (const [questionNum, answer] of Object.entries(answers)) {
      const id = baseId + parseInt(questionNum);
      const unit = getUnit(parseInt(questionNum));

      try {
        const result = await client.query(
          'UPDATE questions SET unit = $1, answer = $2 WHERE id = $3 AND category = $4',
          [unit, answer, id, '생명과학']
        );

        if (result.rowCount && result.rowCount > 0) {
          updatedCount++;
        }
      } catch (err) {
        console.error(`문제 ${questionNum} (id: ${id}) 업데이트 실패:`, err);
        errorCount++;
      }
    }

    console.log(`\n===== 업데이트 완료 =====`);
    console.log(`성공: ${updatedCount}개`);
    console.log(`실패: ${errorCount}개`);

    // 결과 확인
    const checkResult = await client.query(`
      SELECT unit, COUNT(*) as count, MIN(id) as start_id, MAX(id) as end_id
      FROM questions
      WHERE category = '생명과학'
      GROUP BY unit
      ORDER BY MIN(id)
    `);

    console.log('\n===== 단원별 문제 수 =====');
    for (const row of checkResult.rows) {
      console.log(`${row.unit}: ${row.count}개 (id ${row.start_id}~${row.end_id})`);
    }

  } catch (err) {
    console.error('에러 발생:', err);
  } finally {
    client.release();
    await pool.end();
  }
}

updateAnswers();
